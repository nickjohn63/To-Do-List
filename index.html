<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>5-Tab To-Do</title>
  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    :root{ --bg:#f6f7fb; --card:#fff; --ink:#0f172a; --muted:#6b7280; --line:#e5e7eb; --accent:#111827; }
    html,body{ margin:0; height:100%; background:var(--bg); color:var(--ink);
      font: 16px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; -webkit-text-size-adjust:100%; }
    *{ box-sizing:border-box }

    .app{ max-width:900px; margin:0 auto; min-height:100%; display:flex; flex-direction:column; }
    header{ position:sticky; top:0; z-index:10; background:#fff; border-bottom:1px solid var(--line); }
    .title{ padding:12px 16px; font-weight:800; font-size:20px; }
    .tabs{ display:flex; gap:8px; padding:8px; background:#fff; border-top:1px solid var(--line); border-bottom:1px solid var(--line); flex-wrap:wrap; }
    .tab{ border:1px solid var(--line); background:#fff; border-radius:999px; padding:10px 14px; font-weight:700; }
    .tab.active{ background:var(--accent); color:#fff; border-color:var(--accent); }

    main{ padding:12px; display:flex; flex-direction:column; gap:12px; }
    .card{ background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:0 2px 6px rgba(0,0,0,.03); }
    .card h2{ margin:0; padding:10px 12px; border-bottom:1px solid var(--line); font-size:18px; }
    .card .body{ padding:12px; }

    input,select,button{ font:inherit }
    input,select{ width:100%; border:1px solid var(--line); border-radius:12px; padding:12px; background:#fff; }
    button.primary{ width:100%; padding:12px; border:none; border-radius:12px; font-weight:800; background:var(--accent); color:#fff; }

    .grid{ display:grid; gap:10px }
    .three{ grid-template-columns:1fr }
    @media(min-width:640px){ .three{ grid-template-columns:1fr 1fr 1fr } }

    /* TASK LIST: simple blocks (no flex), bulletproof wrapping */
    ul.tasks{ list-style:none; margin:0; padding:0; display:grid; gap:10px }
    li.task{ background:#f8fafc; border:1px solid var(--line); border-radius:12px; padding:12px; position:relative;
             padding-right:108px; padding-bottom:46px; } /* room for two buttons + bottom chip */
    li.task p{ margin:0; white-space:normal; word-break:normal; overflow-wrap:break-word; }

    /* Delete & Date buttons (absolute so they don't affect wrapping) */
    .task-date, .task-del{
      position:absolute; top:8px; width:36px; height:36px;
      border:1px solid var(--line); border-radius:8px;
      background:#fff; cursor:pointer; line-height:1;
    }
    .task-del{ right:8px; }
    .task-date{ right:52px; } /* sits left of delete */

    /* Bottom-left date chip (toggleable) */
    .date-chip{
      position:absolute; left:12px; bottom:8px;
      font-size:12px; color:var(--muted);
      background:#fff; border:1px solid var(--line);
      border-radius:999px; padding:4px 8px;
      display:none;
    }

    /* Larger touch targets on small phones */
    @media(max-width:600px){
      .task-date, .task-del{ width:40px; height:40px; }
      li.task{ padding-right:116px; padding-bottom:50px; }
    }

    footer{ padding:10px; text-align:center; color:#6b7280; font-size:12px; }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="title">5-Tab To-Do</div>
    <nav class="tabs" aria-label="Tabs">
      <button class="tab" id="tab-home" onclick="switchTab('home')">Home</button>
      <button class="tab" id="tab-overdue" onclick="switchTab('overdue')">Overdue</button>
      <button class="tab" id="tab-urgent" onclick="switchTab('urgent')">Urgent</button>
      <button class="tab" id="tab-semi" onclick="switchTab('semi')">Semi-urgent</button>
      <button class="tab" id="tab-sometime" onclick="switchTab('sometime')">Sometime</button>
    </nav>
  </header>

  <main>
    <section class="card">
      <h2>Home</h2>
      <div class="body">
        <form class="grid" onsubmit="addTask(event)" autocomplete="off">
          <label class="grid">
            <span>Task</span>
            <input id="taskText" placeholder="Add a task... (e.g., Call supplier)">
          </label>
          <div class="grid three">
            <label class="grid">
              <span>Category</span>
              <select id="taskCat">
                <option value="urgent">Urgent (5 days)</option>
                <option value="semi">Semi-urgent (10 days)</option>
                <option value="sometime">Sometime (30 days)</option>
              </select>
            </label>
            <label class="grid">
              <span>Insert position</span>
              <select id="taskPos">
                <option value="top">Top of list</option>
                <option value="bottom">End of list</option>
              </select>
            </label>
            <div><button class="primary" type="submit">Add task</button></div>
          </div>
        </form>
      </div>
    </section>

    <section class="card">
      <h2 id="listTitle">Overdue</h2>
      <div class="body">
        <ul class="tasks" id="taskList"></ul>
        <p id="empty" style="display:none;color:#777">Nothing here yet.</p>
      </div>
    </section>
  </main>

  <footer>Saved locally on this device. Works offline on repeat visits.</footer>
</div>

<script>
  if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('./service-worker.js').catch(()=>{})); }

  const STORAGE_KEY='five_tab_todo_text_date_v15';
  function save(arr){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }catch{} }
  function load(){ try{ const raw=localStorage.getItem(STORAGE_KEY); return raw? JSON.parse(raw): []; }catch{ return []; } }
  function uuid(){ return (crypto.randomUUID? crypto.randomUUID(): Date.now().toString(36)+Math.random().toString(36).slice(2,8)); }

  const DEAD={ urgent:5, semi:10, sometime:30 };
  function addDays(d,n){ const x=new Date(d); x.setDate(x.getDate()+n); x.setHours(23,59,59,999); return x; }
  function todayEnd(){ const x=new Date(); x.setHours(23,59,59,999); return x; }

  let active='overdue';
  let state=load();

  const UL=document.getElementById('taskList');
  const EMPTY=document.getElementById('empty');
  const TITLE=document.getElementById('listTitle');

  function switchTab(key){
    active=key;
    ['home','overdue','urgent','semi','sometime'].forEach(k=>{
      const b=document.getElementById('tab-'+k); if(!b) return;
      if(k===key) b.classList.add('active'); else b.classList.remove('active');
    });
    render();
  }

  function addTask(e){
    e.preventDefault();
    const text=(document.getElementById('taskText').value||'').trim();
    if(!text) return;
    const cat=document.getElementById('taskCat').value;
    const pos=document.getElementById('taskPos').value;
    const now=new Date();
    const due=addDays(now, DEAD[cat]);
    const same=state.filter(t=>t.category===cat);
    const orders=same.map(t=>t.order||0);
    const min=orders.length?Math.min(...orders):0;
    const max=orders.length?Math.max(...orders):0;
    const order=pos==='top'?min-1:max+1;
    const task={ id:uuid(), text, category:cat, createdAt:now.toISOString(), dueAt:due.toISOString(), order, showDate:false };
    state.push(task); save(state);
    document.getElementById('taskText').value='';
    switchTab(cat);
  }

  function removeTask(id){
    state = state.filter(t => t.id !== id);
    save(state);
    render();
  }

  function render(){
    const now=todayEnd();
    let items=[];
    if(active==='overdue'){
      TITLE.textContent='Overdue';
      items=state.filter(t=>new Date(t.dueAt)<now);
    }else if(active==='urgent'||active==='semi'||active==='sometime'){
      TITLE.textContent=active==='urgent'?'Urgent':active==='semi'?'Semi-urgent':'Sometime';
      items=state.filter(t=>t.category===active && new Date(t.dueAt)>=now)
                 .sort((a,b)=>(a.order||0)-(b.order||0) || a.createdAt.localeCompare(b.createdAt));
    }else{
      TITLE.textContent='Overdue';
      items=state.filter(t=>new Date(t.dueAt)<now);
    }

    UL.innerHTML='';
    EMPTY.style.display = items.length ? 'none' : 'block';
    items.forEach(t=>{
      const li=document.createElement('li'); li.className='task';

      // Text (wraps naturally)
      const p=document.createElement('p'); p.textContent=t.text;
      li.appendChild(p);

      // Bottom date chip (hidden unless toggled)
      const chip=document.createElement('span'); chip.className='date-chip';
      const created=new Date(t.createdAt);
      chip.textContent='Added: '+created.toLocaleDateString(undefined,{weekday:'short',year:'numeric',month:'short',day:'numeric'});
      chip.style.display = t.showDate ? 'inline-flex' : 'none';
      li.appendChild(chip);

      // Date toggle button
      const dateBtn=document.createElement('button');
      dateBtn.className='task-date'; dateBtn.textContent='ðŸ—“'; dateBtn.setAttribute('aria-label','Toggle added date');
      dateBtn.addEventListener('click', ()=>{
        t.showDate = !t.showDate;
        chip.style.display = t.showDate ? 'inline-flex' : 'none';
        save(state);
      });
      li.appendChild(dateBtn);

      // Delete button
      const del=document.createElement('button'); 
      del.className='task-del'; del.textContent='âœ•'; del.setAttribute('aria-label','Delete task');
      del.addEventListener('click', ()=>removeTask(t.id));
      li.appendChild(del);

      UL.appendChild(li);
    });
  }

  switchTab('overdue');
</script>
</body>
</html>
